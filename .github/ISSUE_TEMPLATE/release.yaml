name:  Release
description: Release/Pre-release of a version.
labels: [release]
body:
- type: dropdown
  id: release_type
  attributes:
    label: Release Type
    description: which type of release is this release?
    options:
    - major release
    - minor release
    - patch release
- type: textarea
  id: release_version
  attributes:
    label: Release Version
    description: Version of this release (e.g `2.4.0`)
    placeholder:
- type: checkboxes
  id: release_tests
  attributes:
    label: "**For all releases** Github Workflow Test Matrix Checkup"
    description: |
      We maintain some integration tests with 3rd party components which we need to manually verify and update before cutting any release.
      An issue exists to automate the following actions: https://github.com/Kong/kubernetes-ingress-controller/issues/1886
      **Wait for tests to pass before continuing with any release**, if any problems are found hold on the release until patches are provided and then run the tests again.
    options:
      - label: check the testing workflow ([.github/workflows/test.yaml](/Kong/kubernetes-ingress-controller/blob/main/.github/workflows/test.yaml)) and ensure that all matrix versions ([`.github/workflows/e2e.yaml`](/Kong/kubernetes-ingress-controller/blob/main/.github/workflows/e2e.yaml) and [`.github/workflows/release.yaml`](/Kong/kubernetes-ingress-controller/blob/main/.github/workflows/release.yaml))  are up to date for various component releases. If there have been any new releases (major, minor or patch) of those components since the latest version seen in that configuration make sure the new versions get added before proceeding with the release. Remove any versions that are no longer supported by the environment provider.
        required: true
      - label: Kubernetes
        required: true
      - label: Istio
        required: true
- type: checkboxes
  id: release_branch
  attributes:
    label: "**For all releases** Create Release Branch"
    description: For this step we're going to start with the `main` branch to create our release branch (e.g. `release/X.Y.Z`) which will later be submitted as a pull request back to `main`.
    options: 
      - label: "ensure that you have up to date copy of `main`: git fetch --all"
        required: true
      - label: "create the release branch for the version (e.g. `release/1.3.1`): `git branch -m release/x.y.z`"
        required: true
      - label: Make any final adjustments to CHANGELOG.md. Double-check that dates are correct, that link anchors point to the correct header, and that you've included a link to the Github compare link at the end.
        required: true
      - label: retrieve the latest license report from FOSSA and save it to LICENSES
        required: true
      - label: "ensure base manifest versions use the new version (`config/image/enterprise/kustomization.yaml` and `config/image/oss/kustomization.yaml`) and update manifest files: `make manifests`"
        required: true
      - label: "push the branch up to the remote: `git push --set-upstream origin release/x.y.z`"
        required: true
- type: checkboxes
  id: release_pr
  attributes:
    label: "**For all releases** Create a Release Pull Request"
    description: For this step we're going to start with the `main` branch to create our release branch (e.g. `release/X.Y.Z`) which will later be submitted as a pull request back to `main`.
    options:
      - label: "ensure that you have up to date copy of `main`: `git fetch --all`"
        required: true
      - label: "create the release branch for the version (e.g. `release/1.3.1`): `git branch -m release/x.y.z`"
        required: true
      - label: Make any final adjustments to CHANGELOG.md. Double-check that dates are correct, that link anchors point to the correct header, and that you've included a link to the Github compare link at the end.
        required: true
      - label: retrieve the latest license report from FOSSA and save it to LICENSES
        required: true
      - label: "ensure base manifest versions use the new version (`config/image/enterprise/kustomization.yaml` and `config/image/oss/kustomization.yaml`) and update manifest files: `make manifests`"
        required: true
      - label: "push the branch up to the remote: `git push --set-upstream origin release/x.y.z`"
        required: true
- type: checkboxes
  id: release_documents
  attributes:
    label: "**For major/minor releases only** Update Release documents"
    options: 
      - label: Create a new branch in the [documentation site repo](https://github.com/Kong/docs.konghq.com).
        required: false
      - label: Copy `app/kubernetes-ingress-controller/OLD_VERSION` to `app/kubernetes-ingress-controller/NEW_VERSION`.
        required: false
      - label: Update articles in the new version as needed.
        required: false
      - label: Update `references/version-compatibility.md` to include the new versions (make sure you capture any new Kubernetes/Istio versions that have been tested)
        required: false
      - label: Copy `app/_data/docs_nav_kic_OLDVERSION.yml` to `app/_data/docs_nav_kic_NEWVERSION.yml`. Add entries for any new articles.
        required: false
      - label: Add a section to `app/_data/kong_versions.yml` for your version.
        required: false
      - label: Open a PR from your branch.
        required: false
- type: checkboxes
  id: release_trouble_shooting
  attributes:
    label: Manual Docker image build
    description: If the "Build and push development images" Github action is not appropriate for your release, or is not operating properly, you can build and push Docker images manually
    options:
      - label: Check out your release tag.
      - label: Run `make container`. Note that you can set the `TAG` environment variable if you need to override the current tag in Makefile.
      - label: Add additional tags for your container (e.g. `docker tag kong/kubernetes-ingress-controller:1.2.0-alpine kong/kubernetes-ingress-controller:1.2.0; docker tag kong/kubernetes-ingress-controller:1.2.0-alpine kong/kubernetes-ingress-controller:1.2`)
      - label: Create a temporary token for the `kongbot` user (see 1Password) and log in using it.
      - label: Push each of your tags (e.g. `docker push kong/kubernetes-ingress-controller:1.2.0-alpine`)